---
import { getCollection } from 'astro:content';

const title = 'Published Articles';

// getCollection() ordering is non-deterministic; sort for consistent newest-first listing.
const posts = (await getCollection('blog'))
  // Hide the initial example post.
  .filter((post) => post.id !== 'hello-world')
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} - Mugume Twinamatsiko Atwine</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="/blog.css" />
  </head>
  <body class="blog">
    <div class="container">
      <nav class="navbar">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/blog/">Articles</a></li>
        </ul>
      </nav>

      <main>
        <section>
          <h1>Published Articles</h1>
          {posts.length === 0 ? (
            <p>No posts yet.</p>
          ) : (
            <ul class="blog-post-list">
              {posts.map((post) => (
                <li class="blog-post-list-item">
                  <a class="blog-post-card" href={`/blog/${post.id}/`}>
                    <div class="blog-post-card__date">{post.data.date.toISOString().slice(0, 10)}</div>
                    <h2 class="blog-post-card__title">{post.data.title}</h2>
                    <div class="blog-post-card__description">{post.data.description}</div>
                  </a>
                </li>
              ))}
            </ul>
          )}
        </section>
      </main>
    </div>
    <!-- main.js is homepage-only (scroll popup); avoid errors on /blog where those DOM IDs don't exist. -->
  </body>
</html>
